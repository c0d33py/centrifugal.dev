"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[8693],{1399:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var r=n(7462),a=(n(7294),n(3905));const o={id:"http_stream",title:"HTTP streaming, with bidirectional emulation",sidebar_label:"HTTP streaming"},i=void 0,s={unversionedId:"transports/http_stream",id:"transports/http_stream",title:"HTTP streaming, with bidirectional emulation",description:"HTTP streaming is a technique based on using a long-lived HTTP connection between a client and a server with a chunked transfer encoding. Usually it only allows unidirectional flow of messages from server to client but with Centrifugo bidirectional emulation layer it may be used as a full-featured fallback or alternative to WebSocket.",source:"@site/docs/transports/http_stream.md",sourceDirName:"transports",slug:"/transports/http_stream",permalink:"/docs/transports/http_stream",draft:!1,editUrl:"https://github.com/centrifugal/centrifugal.dev/edit/main/docs/transports/http_stream.md",tags:[],version:"current",frontMatter:{id:"http_stream",title:"HTTP streaming, with bidirectional emulation",sidebar_label:"HTTP streaming"},sidebar:"Transports",previous:{title:"WebSocket",permalink:"/docs/transports/websocket"},next:{title:"SSE (EventSource)",permalink:"/docs/transports/sse"}},l={},c=[{value:"Options",id:"options",level:2},{value:"http_stream",id:"http_stream",level:3},{value:"http_stream_max_request_body_size",id:"http_stream_max_request_body_size",level:3}],p={toc:c};function u(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"HTTP streaming is a technique based on using a long-lived HTTP connection between a client and a server with a chunked transfer encoding. Usually it only allows unidirectional flow of messages from server to client but with ",(0,a.kt)("a",{parentName:"p",href:"https://centrifugal.dev/blog/2022/07/19/centrifugo-v4-released#modern-websocket-emulation-in-javascript"},"Centrifugo bidirectional emulation layer")," it may be used as a full-featured fallback or alternative to WebSocket."),(0,a.kt)("p",null,"HTTP-streaming connection endpoint in Centrifugo is:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"/connection/http_stream\n")),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"This transport is only implemented by our Javascript SDK. Internally it uses modern ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API"},"Fetch")," and ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream"},"Readable Streams")," API. HTTP-streaming fully supports binary transfer using our Protobuf protocol.")),(0,a.kt)("p",null,"Here is an example how to use JavaScript SDK with WebSocket as the main transport and HTTP-streaming transport fallback:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="Use HTTP-streaming with bidirectional emulation as a fallback for WebSocket in JS SDK"',title:'"Use',"HTTP-streaming":!0,with:!0,bidirectional:!0,emulation:!0,as:!0,a:!0,fallback:!0,for:!0,WebSocket:!0,in:!0,JS:!0,'SDK"':!0},"const transports = [\n    {\n        transport: 'websocket',\n        endpoint: 'ws://localhost:8000/connection/websocket'\n    },\n    {\n        transport: 'http_stream',\n        endpoint: 'http://localhost:8000/connection/http_stream'\n    }\n];\nconst centrifuge = new Centrifuge(transports);\ncentrifuge.connect()\n")),(0,a.kt)("admonition",{type:"danger"},(0,a.kt)("p",{parentName:"admonition"},"Make sure ",(0,a.kt)("a",{parentName:"p",href:"/docs/server/configuration#allowed_origins"},"allowed_origins")," are properly configured.")),(0,a.kt)("h2",{id:"options"},"Options"),(0,a.kt)("h3",{id:"http_stream"},"http_stream"),(0,a.kt)("p",null,"Boolean, default: ",(0,a.kt)("inlineCode",{parentName:"p"},"false"),"."),(0,a.kt)("p",null,"Enables HTTP streaming endpoint. And enables emulation endpoint (",(0,a.kt)("inlineCode",{parentName:"p"},"/emulation")," by default) to accept emulation HTTP requests from clients."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="config.json"',title:'"config.json"'},'{\n    ...\n    "http_stream": true\n}\n')),(0,a.kt)("p",null,"When enabling ",(0,a.kt)("inlineCode",{parentName:"p"},"http_stream")," you can connect to ",(0,a.kt)("inlineCode",{parentName:"p"},"/connection/http_stream")," from ",(0,a.kt)("inlineCode",{parentName:"p"},"centrifuge-js"),". Note that our bidirectional emulation also uses ",(0,a.kt)("inlineCode",{parentName:"p"},"/emulation")," endpoint of Centrifugo to send requests from client to server. This is required because HTTP streaming is a unidirectional transport in its nature. So we use HTTP call to send data from client to server and proxy this call to the correct Centrifugo node which handles the connection. Thus achieving bidirectional behaviour - see details about ",(0,a.kt)("a",{parentName:"p",href:"https://centrifugal.dev/blog/2022/07/19/centrifugo-v4-released#modern-websocket-emulation-in-javascript"},"Centrifugo bidirectional emulation layer"),". Make sure ",(0,a.kt)("inlineCode",{parentName:"p"},"/emulation")," endpoint is available for requests from the client side too. If required, you can also control both HTTP streaming connection url prefix and emulation endpoint prefix, see ",(0,a.kt)("a",{parentName:"p",href:"/docs/server/configuration#customize-handler-endpoints"},"customizing endpoints"),"."),(0,a.kt)("h3",{id:"http_stream_max_request_body_size"},"http_stream_max_request_body_size"),(0,a.kt)("p",null,"Default: 65536 (64KB)"),(0,a.kt)("p",null,"Maximum allowed size of a initial HTTP POST request in bytes."))}u.isMDXComponent=!0},3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=c(n),d=a,f=m["".concat(l,".").concat(d)]||m[d]||u[d]||o;return n?r.createElement(f,i(i({ref:t},p),{},{components:n})):r.createElement(f,i({ref:t},p))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);