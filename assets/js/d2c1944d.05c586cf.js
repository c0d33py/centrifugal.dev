"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[1695],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>h});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),m=p(t),h=r,d=m["".concat(s,".").concat(h)]||m[h]||u[h]||i;return t?a.createElement(d,l(l({ref:n},c),{},{components:t})):a.createElement(d,l({ref:n},c))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,l=new Array(i);l[0]=m;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var p=2;p<i;p++)l[p]=t[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},101:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var a=t(7462),r=(t(7294),t(3905));const i={id:"channel_patterns",sidebar_label:"Channel patterns",title:"Channel patterns"},l=void 0,o={unversionedId:"pro/channel_patterns",id:"pro/channel_patterns",title:"Channel patterns",description:"Centrifugo PRO enhances a way to configure channels with Channel Patterns feature. This opens a road for building channel model similar to what developers got used to when writing HTTP servers and configuring routes for HTTP request processing.",source:"@site/docs/pro/channel_patterns.md",sourceDirName:"pro",slug:"/pro/channel_patterns",permalink:"/docs/pro/channel_patterns",draft:!1,editUrl:"https://github.com/centrifugal/centrifugal.dev/edit/main/docs/pro/channel_patterns.md",tags:[],version:"current",frontMatter:{id:"channel_patterns",sidebar_label:"Channel patterns",title:"Channel patterns"},sidebar:"Pro",previous:{title:"Channel capabilities",permalink:"/docs/pro/capabilities"},next:{title:"CEL expressions",permalink:"/docs/pro/cel_expressions"}},s={},p=[{value:"Configuration",id:"configuration",level:3},{value:"Implementation details",id:"implementation-details",level:3},{value:"Variables",id:"variables",level:3},{value:"Using varibles",id:"using-varibles",level:3}],c={toc:p};function u(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Centrifugo PRO enhances a way to configure channels with Channel Patterns feature. This opens a road for building channel model similar to what developers got used to when writing HTTP servers and configuring routes for HTTP request processing."),(0,r.kt)("h3",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"Let's look at the example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    // rest of the config ...\n    "channel_patterns": true, // required to turn on the feature.\n    "namespaces": [\n        {\n            "name": "/users/:name"\n            // namespace options may go here ...\n        },\n        {\n            "name": "/events/:project/:type"\n            // namespace options may go here ...\n        }\n    ]\n}\n')),(0,r.kt)("p",null,"As soon as namespace name starts with ",(0,r.kt)("inlineCode",{parentName:"p"},"/")," - it's considered a channel pattern. Just like an HTTP path it consists of segments delimited by ",(0,r.kt)("inlineCode",{parentName:"p"},"/"),". The ",(0,r.kt)("inlineCode",{parentName:"p"},":")," symbol in the segment beginning defines a variable part \u2013 more information below."),(0,r.kt)("p",null,"In this case a channel to be used must be sth like ",(0,r.kt)("inlineCode",{parentName:"p"},"/users/mario")," - i.e. start with ",(0,r.kt)("inlineCode",{parentName:"p"},"/")," and match one of the patterns defined in the configuration. So this channel pattern matching mechanics behaves mostly like HTTP route matching in many frameworks."),(0,r.kt)("p",null,"Given the configuration example above:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"if channel is ",(0,r.kt)("inlineCode",{parentName:"li"},"/users/mario"),", then the namespace with the name ",(0,r.kt)("inlineCode",{parentName:"li"},"/users/:name")," will match and we apply all the options defined for it to the channel."),(0,r.kt)("li",{parentName:"ul"},"if channel is ",(0,r.kt)("inlineCode",{parentName:"li"},"/events/42/news"),", then the namespace with the name ",(0,r.kt)("inlineCode",{parentName:"li"},"/events/:project/:type")," will match."),(0,r.kt)("li",{parentName:"ul"},"if channel is ",(0,r.kt)("inlineCode",{parentName:"li"},"/events/42"),", then no namespace will match and the ",(0,r.kt)("inlineCode",{parentName:"li"},"unknown channel")," error will be returned.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="Basic example demonstrating use of pattern channels in JS"',title:'"Basic',example:!0,demonstrating:!0,use:!0,of:!0,pattern:!0,channels:!0,in:!0,'JS"':!0},"const client := new Centrifuge(\"ws://...\", {});\nconst sub = client.newSubscription('/users/mario');\nsub.subscribe();\nclient.connect();\n")),(0,r.kt)("h3",{id:"implementation-details"},"Implementation details"),(0,r.kt)("p",null,"Some implementation restrictions and details to know about:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"When using channel patterns feature ",(0,r.kt)("inlineCode",{parentName:"li"},":")," symbol in a namespace name defines a variable part. It's not related to a namespace separator anymore \u2013 the entire channel is matched over the channel pattern. Similar to the HTTP routes semantics. So namespace separator is not needed at all when using channel patterns."),(0,r.kt)("li",{parentName:"ul"},"Centrifugo only allows explicit channel pattern matching which do not result into channel pattern conflicts in runtime, this is checked during configuration validation on server start. Explicitly defined static patterns (without variables) have precedence over patterns with variables."),(0,r.kt)("li",{parentName:"ul"},"There is no analogue of top-level namespace (like we have for standard namespace configuration) for channels starting with ",(0,r.kt)("inlineCode",{parentName:"li"},"/"),". If a channel does not match any explicitly defined pattern then Centrifugo returns the ",(0,r.kt)("inlineCode",{parentName:"li"},"102: unknown channel")," error."),(0,r.kt)("li",{parentName:"ul"},"If you define ",(0,r.kt)("inlineCode",{parentName:"li"},"channel_regex")," inside channel pattern options \u2013 then regex matches over the entire channel (since variable parts are located in the namespace name in this case)."),(0,r.kt)("li",{parentName:"ul"},"Channel pattern must only contain ASCII characters."),(0,r.kt)("li",{parentName:"ul"},"Duplicate variable names are not allowed inside an individual pattern, i.e. defining ",(0,r.kt)("inlineCode",{parentName:"li"},"/users/:user/:user")," will result into validation error on start.")),(0,r.kt)("h3",{id:"variables"},"Variables"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},":")," in the channel pattern name helps to define a variable to match against. Named parameters only match a single segment of the channel:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'Channel pattern "/users/:name":\n\n/users/mary         \u2705 match\n/users/john         \u2705 match\n/users/mary/info    \u274c no match \n/users              \u274c no match\n')),(0,r.kt)("p",null,"Another example for channel pattern ",(0,r.kt)("inlineCode",{parentName:"p"},"/news/:type/:subtype"),", i.e. with multiple variables:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'Channel pattern "/news/:type/:subtype":\n\n/news/sport/football       \u2705 match\n/news/sport/volleyball     \u2705 match\n/news/sport                \u274c no match\n/news                      \u274c no match\n')),(0,r.kt)("p",null,"Channel patterns support mid-segment variables, so the following is possible:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'Channel pattern "/personal/user_:user":\n\n/personal/user_mary     \u2705 match\n/personal/user_john     \u2705 match\n/personal/user_         \u274c no match\n')),(0,r.kt)("h3",{id:"using-varibles"},"Using varibles"),(0,r.kt)("p",null,"Additional benefits of using channel patterns may be achieved together with Centrifugo PRO ",(0,r.kt)("a",{parentName:"p",href:"/docs/pro/cel_expressions"},"CEL expressions"),". Channel pattern variables are available inside CEL expressions for evaluation in a custom way."))}u.isMDXComponent=!0}}]);